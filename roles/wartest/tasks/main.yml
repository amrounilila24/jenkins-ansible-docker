---
- name: Install pip
  apt:
    name: python3-pip
    state: present
    update_cache: yes

- name: Install Docker Python libraries
  pip:
    name:
      - docker
      - docker-compose

- name: Login to GitLab Registry
  community.docker.docker_login:
    registry_url: registry.gitlab.com
    username: "{{ gitlab_user }}"
    password: "{{ gitlab_token }}"

# üîç DEBUG (TEMPORAIRE)
- name: Debug image finale
  debug:
    msg: "Image finale = {{ registry_image }}:{{ image }}"

- name: Run container
  community.docker.docker_container:
    name: wartest
    image: "{{ registry_image }}:{{ image }}"
    published_ports:
      - "8081:8080"
    state: started
